---
title: "Fitting A-Cc curves"
author: "Remko Duursma"
date: "19 April 2016"
output: 
  html_document:
    code_folding: hide
---


## Example

For illustration, use all 'sun' data from Court, fit a single A-Ci or A-Cc curve. We use a representative value of 0.15 for the mesophyll conductance.

```{r}
# Prepare data
library(plantecophys)

sun <- read.csv("sunleafaci.csv")
sun <- droplevels(subset(sun, chamber != "ch04"))

GMESO <- 0.15  # ca. mean of measurements

# for later
meso <- read.csv("gm_means.csv")
shade <- read.csv("shadeleafaci.csv")

```

```{r eval=FALSE,warning=FALSE}

# optionally fit all A-Ci curves

# fit normal Aci curve (no gmeso)
fsun <- fitacis(sun, "chamber")
fshade <- fitacis(shade, "chamber")
```


```{r warning=FALSE}

# Fit single curve, standard
fsun <- fitaci(sun)

# simulate from standard Aci curve
a <- Aci(Ci=seq(50,2000,by=10), Vcmax=coef(fsun)["Vcmax"], 
         Jmax=coef(fsun)["Jmax"], Rd=coef(fsun)["Rd"])

# calculate Cc for the simulated curves
a$Cc <- with(a, Ci - ALEAF / GMESO)

# calculate Cc on measurements *using same gmeso as in above line*
sun$Cc <- with(sun, Ci - Photo/GMESO)  

# measurements
with(sun, plot(Ci, Photo, main="Standard"))
# simulations
with(a, lines(Ci, ALEAF, col="red"))

with(sun, plot(Cc, Photo, main="Cc-based"))
# simulations
with(a, lines(Cc, ALEAF, col="red"))
```

The plots above show photosynthesis versus Ci, or estimated Cc (from Cc = Ci - Anet/gmeso) for this example. The second plot was made by a) simulating photosynthesis from Ci from the fitted standard A-Ci model, and b) *calculating* Cc from Ci (as Cc = Ci - ALEAF/GMESO, where ALEAF is fitted net photosynthesis).

The standard `plantecophys` plot for the fitted A-Ci curve is below.

```{r}
plot(fsun)
```



## Fitting A-Cc

Now fit the A-Cc curve directly, so that the resulting Vcmax and Jmax can be interpreted as chloroplastic rates. This works only (it seems) when we specify the transition point, which I estimate first from the fitted standard model above.

The standard plot (but versus Cc, not Ci) shows that the simulated photosynthetic rate is **always Aj-limited**. Clearly the model fits the data very poorly, when we assume that 1) Vcmax and Jmax are chloroplastic rates, 2) all other parameters are unchanged, in particular GammaStar, and 3) mesophyll conductance is constant with Cc.  

Note that all measurements were done at 25C, so temperature responses are irrelevant.


```{r warning=FALSE}
j <- fitaci(sun, citransition=fsun$Ci_transition, gmeso=force(GMESO))

simj <- Aci(Ci=seq(50,2000,by=10), Vcmax=coef(j)["Vcmax"], 
         Jmax=coef(j)["Jmax"], Rd=coef(j)["Rd"], gmeso=GMESO)
simj$Cc <- with(simj, Ci - ALEAF/GMESO)

with(sun, plot(Cc, Photo, pch=19))
with(simj, lines(Cc, Ac-Rd, col="red"))
with(simj, lines(Cc, Aj-Rd, col="blue"))
```

## Parameter estimates

Parameter estimates for Ci-basis were: Vcmax = `r coef(fsun)["Vcmax"]`, Jmax = `r coef(fsun)["Jmax"]`, for Cc-basis:  Vcmax = `r coef(j)["Vcmax"]`, Jmax = `r coef(j)["Jmax"]`.

The much (much) higher Vcmax-cc is consistent with quite a low mesophyll conductance (see Ethier & Livingstone), but the estimate of gmes is consistent with other trees and especially Eucalyptus (says Court).










